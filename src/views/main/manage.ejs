<%- include('../layout/head.ejs') %>
<link rel="stylesheet" href="/css/main.css">
<title>Funix-ASM1</title>
</head>
<!-- ------------------------------------- -->

<body>
<!-- include navbar -->
<%- include('../layout/navbar.ejs') %>
<!-- ------------------------------------- -->
<main>
   <div class="container">
      <div class="row">
       <!-- thông tin giờ làm nhân viên -->
        <div class=" text-center mt-5 justify-content-center align-items-center">
          <h4>THÔNG TIN GIỜ LÀM NHÂN VIÊN</h4>
          <br>
          <!-- loop userList -->
          <% for (let user of userList) { %>
            <h5 class="mt-5">Tên Nhân Viên: <%= user.name %></h5>
            <!-- staff vaccine info stripe table -->
            <!-- bootstrap stripe table -->
            <form action="/manage-change-status" class="text-center" method="POST">
               <input type="hidden" name="_csrf" value="<%= csrfToken %>">
               <button class="btn btn-primary mt-3">Chuyển Trạng Thái</button>
            </form>
            <table class="table table-striped table-hover">
               <thead>
               <tr>
                  <th scope="col">Date</th>
                  <th scope="col">Workplace</th>
                  <th scope="col">Checkin</th>
                  <th scope="col">Checkout</th>
                  <th scope="col">Work Time</th>
                  <th scope="col">Xóa Dữ Liệu</th>
               </tr>
               </thead>
               <tbody>
               <% const workHistory = user.progress.workHistory %>
               <% if (workHistory.length === 0) { %>
                  <tr>
                     <td class="col-12 col-sm-2">--</td>
                     <td class="col-12 col-sm-2">--</td>
                     <td class="col-12 col-sm-2">--</td>
                     <td class="col-12 col-sm-2">--</td>
                     <td class="col-12 col-sm-2">--</td>
                     <td class="col-12 col-sm-2">--</td>
                  </tr> 
               <% }
               else { 
                  workHistory.forEach( history => { %>
                  <tr>
                     <td class="col-12 col-sm-2"><%= history.checkin.toDateString().replace(/^\S+\s/,'') %></td>
                     <td class="col-12 col-sm-2"><%= history.workplace %></td>
                     <td class="col-12 col-sm-2"><%= history.checkin.getHours().toString() + ":" + history.checkin.getMinutes().toString() %></td>
                     <td class="col-12 col-sm-2">
                        <% if (history.checkout === null) { %>
                           <%= '--:--' %>
                        <% } else { %>
                           <%= history.checkout.getHours().toString() + ":" + history.checkout.getMinutes().toString(); %>
                        <% } %>
                     </td>
                     <td class="col-12 col-sm-2">
                        <% if (history.checkout === null) { %>
                           <%= '--:--' %>
                        <% } else {
                           const workTime = history.checkout.getTime() - history.checkin.getTime();
                           let workTimeSeconds = Math.floor(workTime / 1000);
                           let workTimeMinutes = Math.floor(workTimeSeconds / 60);
                           let workTimeHours = Math.floor(workTimeMinutes / 60);
                           workTimeMinutes = workTimeMinutes % 60; %>
                           <%= history.checkout === null ? "--:--" : workTimeHours + ":" + workTimeMinutes %>
                        <% } %>
                     </td>
                     <td class="col-12 col-sm-2">
                        <form action="/manage-delete-work" class="text-center" method="POST">
                           <input type="hidden" name="_csrf" value="<%= csrfToken %>">
                           <button type="submit" class="btn btn-danger">Xóa</button>
                        </form>
                     </td>
                  </tr> 
                  <% }) %>
               <% } %>
               </tbody>
            </table>
            <% } %>
       </div>
      </div>
   </div>
</main>

<!-- ------------------------------------- -->
<%- include('../layout/end.ejs') %>
</body>